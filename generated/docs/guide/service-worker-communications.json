{
  "id": "guide/service-worker-communications",
  "title": "Service worker communication",
  "contents": "\n<div class=\"content\">\n<h1 translation-origin=\"off\" id=\"service-worker-communication\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#service-worker-communication\"><i class=\"material-icons\">link</i></a>Service worker communication</h1>\n<p translation-origin=\"off\">Importing <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> into your <code>AppModule</code> doesn't just register the service worker, it also provides a few services you can use to interact with the service worker and control the caching of your app.</p>\n<h4 translation-origin=\"off\" id=\"prerequisites\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#prerequisites\"><i class=\"material-icons\">link</i></a>Prerequisites</h4>\n<p translation-origin=\"off\">A basic understanding of the following:</p>\n<ul>\n<li><a href=\"guide/service-worker-getting-started\">Getting Started with Service Workers</a>.</li>\n</ul>\n<hr>\n<h2 translation-origin=\"off\" id=\"swupdate-service\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-service\"><i class=\"material-icons\">link</i></a><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service</h2>\n<p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service gives you access to events that indicate when the service worker has discovered an available update for your app or when it has activated such an updateâ€”meaning it is now serving content from that update to your app.</p>\n<p translation-origin=\"off\">The <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> service supports four separate operations:</p>\n<ul>\n<li>\n<p translation-origin=\"off\">Getting notified of <em>available</em> updates. These are new versions of the app to be loaded if the page is refreshed.</p>\n</li>\n<li>\n<p translation-origin=\"off\">Getting notified of update <em>activation</em>. This is when the service worker starts serving a new version of the app immediately.</p>\n</li>\n<li>\n<p translation-origin=\"off\">Asking the service worker to check the server for new updates.</p>\n</li>\n<li>\n<p translation-origin=\"off\">Asking the service worker to activate the latest version of the app for the current tab.</p>\n</li>\n</ul>\n<h3 translation-origin=\"off\" id=\"available-and-activated-updates\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#available-and-activated-updates\"><i class=\"material-icons\">link</i></a>Available and activated updates</h3>\n<p translation-origin=\"off\">The two update events, <code>available</code> and <code>activated</code>, are <code>Observable</code> properties of <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code>:</p>\n<code-example path=\"service-worker-getting-started/src/app/log-update.service.ts\" linenums=\"false\" title=\"log-update.service.ts\" region=\"sw-update\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class LogUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event => {\n      console.log('current version is', event.current);\n      console.log('available version is', event.available);\n    });\n    updates.activated.subscribe(event => {\n      console.log('old version was', event.previous);\n      console.log('new version is', event.current);\n    });\n  }\n}\n\n</code-example>\n<p translation-origin=\"off\">You can use these events to notify the user of a pending update or to refresh their pages when the code they are running is out of date.</p>\n<h3 translation-origin=\"off\" id=\"checking-for-updates\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#checking-for-updates\"><i class=\"material-icons\">link</i></a>Checking for updates</h3>\n<p translation-origin=\"off\">It's possible to ask the service worker to check if any updates have been deployed to the server. You might choose to do this if you have a site that changes frequently or want updates to happen on a schedule.</p>\n<p translation-origin=\"off\">Do this with the <code>checkForUpdate()</code> method:</p>\n<code-example path=\"service-worker-getting-started/src/app/check-for-update.service.ts\" linenums=\"false\" title=\"check-for-update.service.ts\" region=\"sw-check-update\">\nimport { interval } from 'rxjs/observable/interval';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class CheckForUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    interval(6 * 60 * 60).subscribe(() => updates.checkForUpdate());\n  }\n}\n\n</code-example>\n<p translation-origin=\"off\">This method returns a <code>Promise</code> which indicates that the update check has completed successfully, though it does not indicate whether an update was discovered as a result of the check. Even if one is found, the service worker must still successfully download the changed files, which can fail. If successful, the <code>available</code> event will indicate availability of a new version of the app.</p>\n<h3 translation-origin=\"off\" id=\"forcing-update-activation\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#forcing-update-activation\"><i class=\"material-icons\">link</i></a>Forcing update activation</h3>\n<p translation-origin=\"off\">If the current tab needs to be updated to the latest app version immediately, it can ask to do so with the <code>activateUpdate()</code> method:</p>\n<code-example path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" linenums=\"false\" title=\"prompt-update.service.ts\" region=\"sw-activate\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class PromptUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event => {\n      if (promptUser(event)) {\n        updates.activateUpdate().then(() => document.location.reload());\n      }\n    });\n  }\n}\n\n</code-example>\n<p translation-origin=\"off\">Doing this could break lazy-loading into currently running apps, especially if the lazy-loaded chunks use filenames with hashes, which change every version.</p>\n<h2 translation-origin=\"off\" id=\"more-on-angular-service-workers\"><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#more-on-angular-service-workers\"><i class=\"material-icons\">link</i></a>More on Angular service workers</h2>\n<p translation-origin=\"off\">You may also be interested in the following:</p>\n<ul>\n<li><a href=\"guide/service-worker-devops\">Service Worker in Production</a>.</li>\n</ul>\n\n</div>\n<!-- links to this doc:\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n-->\n<!-- links from this doc:\n - api/core/Injectable\n - api/service-worker/ServiceWorkerModule\n - api/service-worker/SwUpdate\n - guide/service-worker-communications#available-and-activated-updates\n - guide/service-worker-communications#checking-for-updates\n - guide/service-worker-communications#forcing-update-activation\n - guide/service-worker-communications#more-on-angular-service-workers\n - guide/service-worker-communications#prerequisites\n - guide/service-worker-communications#service-worker-communication\n - guide/service-worker-communications#swupdate-service\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n-->"
}